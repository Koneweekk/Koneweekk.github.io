---
title: 웹 - XSS와 CSRF
date: 2024-05-27 10:10:00 +09:00
categories: [CS, 웹]
tags: [CS, Web, cookie, session, xss, csrf]
---

## Ⅰ. XSS (Cross-Site Scripting)

### 1. XSS (Cross-Site Scripting)란?

- 웹 애플리케이션에서 사용자 입력을 제대로 검증하지 않을 때 발생하는 취약점
- 공격자는 악성 스크립트를 웹 페이지에 삽입하여 다른 사용자가 페이지를 방문할 때 실행

---

### 2. XSS(Cross-Site Scripting)의 종류

#### Stored XSS
악성 스크립트가 서버에 저장되고 여러 사용자에게 전파
예를 들어, 사용자 프로필에 악성 스크립트를 저장하면, 해당 프로필을 보는 모든 사용자가 공격을 받음

#### Reflected XSS
- 악성 스크립트가 URL 매개변수 등을 통해 서버에 전송
- 그 응답으로 포함되어 사용자에게 돌아옴
- 예를 들어, 검색 쿼리에 악성 스크립트를 포함하면, 검색 결과 페이지에 스크립트가 실행

#### DOM-based XSS
- 클라이언트 측 코드(주로 JavaScript)가 DOM(Document Object Model)을 조작하면서 발생하는 취약점
- 서버와의 통신 없이 브라우저에서 직접 발생

---

### 3. XSS(Cross-Site Scripting)의 영향

#### 세션 하이재킹
- 공격자가 사용자의 세션 쿠키를 탈취하여 사용자로 가장
  
#### 피싱
- 악성 스크립트를 이용해 사용자의 입력을 가로채거나, 가짜 로그인 페이지로 유도 가능
  
#### 데이터 도난
- 사용자의 개인 정보를 탈취 가능

---

### 4. 방어 방법

#### 입력 검증 및 인코딩
- 사용자 입력을 검증하고, HTML 엔티티로 인코딩하여 스크립트가 실행되지 않도록 한다.
  
#### Content Security Policy(CSP)
- 스크립트의 출처를 제한하여, 악성 스크립트가 실행되지 않도록 한다.
  
#### Escaping
- 출력 시 사용자 입력을 HTML, JavaScript, CSS 등의 문맥에 맞게 이스케이프한다.

---
<br>

## Ⅱ. CSRF (Cross-Site Request Forgery)

### 1. CSRF (Cross-Site Request Forgery)란?

- 사용자가 인증된 세션을 이용하여 원치 않는 요청을 서버에 보내도록 유도하는 공격
- 공격자는 사용자가 인증된 상태를 악용하여, 사용자가 의도하지 않은 상태 변경 요청을 서버에 보내게 한다.

---

### 2. 공격 방법

#### 사회공학
- 공격자가 사용자를 속여 악성 링크를 클릭하게 하거나
- 악성 스크립트를 포함한 페이지를 방문하게 합니다.
  
#### 자동 요청
- 사용자가 로그인된 상태에서 공격자가 만든 페이지를 방문하면, 브라우저가 자동으로 요청을 전송

#### 예시
- 사용자가 은행 웹사이트에 로그인한 상태
- 공격자가 CSRF 공격을 포함한 페이지로 사용자를 유도
- 해당 페이지는 사용자의 인증된 세션을 이용하여 은행 웹사이트에 돈을 송금하는 요청

---

### 3. 영향

#### 데이터 변경
- 공격자는 사용자의 인증된 세션을 이용하여 데이터베이스에서 데이터를 수정하거나 삭제 가능

#### 금전적 손실
- 금융 거래 사이트에서 사용자의 돈을 다른 계좌로 송금 가능

---

### 4. 방어 방법

#### CSRF 토큰 사용
- 각 요청에 고유한 토큰을 포함시켜, 서버에서 이를 검증
-  토큰이 일치하지 않으면 요청을 거부
  
#### Referer 헤더 검증
- 요청의 출처를 확인하여, 신뢰할 수 있는 도메인에서 온 요청만 처리

#### SameSite 쿠키 속성
- 브라우저에서 쿠키를 전송할 때, SameSite 속성을 설정
- 외부 사이트에서 발생한 요청에는 쿠키가 전송되지 않도록 한다.