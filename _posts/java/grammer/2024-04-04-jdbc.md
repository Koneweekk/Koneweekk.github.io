---
title: JAVA - JDBC
date: 2024-04-04 12:00:00 +09:00
categories: [Java, 문법]
tags:
  [
    프로그래밍 언어,
    Java,
    JDBC,
    DB
  ]
---

## Ⅰ. JDBC 개요

### ⅰ. JDBC란?

> Java Database Connectivity  
> Java 프로그램이 데이터베이스와 상호 작용하기 위한 자바 API

- Java 애플리케이션에서 다양한 종류의 관계형 데이터베이스에 액세스 가능
- 데이터베이스 연결을 설정하고, SQL 문을 실행하고, 쿼리 결과를 처리하는데 사용
  
<hr>

### ⅱ. JDBC 연관관계

![JDBC 연관관계](https://mblogthumb-phinf.pstatic.net/MjAxOTA1MDZfMjA3/MDAxNTU3MDcwOTcwMTc0.XWznpDstUdd4Mi_gplCbIdd930z9NLi74qXsZ56ot98g.wMmIdewP6lVLYw8rawTHQw0YpNOTRrUu8yWtf3vX4o8g.PNG.kimhecan/SE-c60489d3-23ab-4db0-a135-fdfef7bacc22.png?type=w800)

DriverManager
- JDBC 드라이버를 관리하고, 데이터베이스에 연결을 생성
- getConnection() 메서드를 통해 데이터베이스와의 연결을 확립

Connection
- 데이터베이스와의 연결을 나타내는 인터페이스
- 데이터베이스와의 세션을 유지하며, SQL 문을 실행하기 위한 기본 메서드들을 제공
- createStatement() 메서드를 통해 Statement 객체를 생성할 수 있습니다.

Statement
- SQL 문을 실행하기 위한 인터페이스입니다
- executeQuery() 메서드를 통해 SELECT 문을 실행하고 결과를 가져있음
- executeUpdate() 메서드를 통해 INSERT, UPDATE, DELETE 등의 문을 실행

PreparedStatement
- 미리 컴파일된 SQL 문을 나타내는 인터페이스입니다
- Statement와 유사하지만, 매개변수화된 쿼리를 효율적으로 실행 가능

ResultSet
- SQL 쿼리의 결과를 나타내는 인터페이스
- 데이터베이스로부터 검색된 행을 포함
- 행 단위로 이동하면서 데이터에 접근할 수 있음

<hr><br>

## Ⅱ. JDBC 활용 과정

### ⅰ. Driver 설치

JDBC를 DB에 연결시키기 위해선 Driver를 설치해야한다.

Oracle DB의 Driver 설치 방법은 다음과 같다.

우선 Java 프로젝트의 Properties에 접근한다.

<img src="/assets/img/post/language/java/jdbc/01.png" width="50%" title="01" alt="01"/>  

이후 클래스 패스에 Driver jar 파일을 추가해준다. 파일의 위치는 다음과 같다

> C:\oraclexe\app\oracle\product\11.2.0\server\jdbc\lib

<img src="/assets/img/post/language/java/jdbc/02.png" width="70%" title="02" alt="02"/>  

<hr>

### ⅱ. Driver 메모리 로딩

`Class.forName` 메서드
- 문자열로 주어진 JDBC Driver 클래스를 Build Path에서 찾고, 메모리 로딩
- `DriverManager`에 JDBC Driver 객체 등록
- 실행 실패하면 `ClassNotFoundException` 발생 → 예외 처리 해주어야함

```java
Class.forName("oracle.jdbc.OracleDriver");
```

<hr>

### ⅲ. DB에 연결

`DriverManager`의 `getConnection` 메서드를 통해 DB에 연결

- 연결 성공하면 `Connection` 객체를 리턴
- 실패시 `SQLException` 예외가 발생 → 예외 처리 해주어야함

```java
Connection conn =  DriverManager.getConnection("연결 문자열", "사용자이름", "비밀번호");
```

> 연결 문자열 예시 : jdbc:oracle:thin:@localhost:1521:xe

- `jdbc:oracle:thin` - TCP용 JDBC Driver를 사용한다는 뜻
- `@localhost` - 로컬에 설치된 Oracle을 사용하겠다는 뜻
- `1521` - 포트 번호
- `xe` - DB명

<hr>

### ⅳ. 명령 객체 생성

- DB에 명령을 내리기 위해선 명령 객체를 생성해야한다.

```java
Statement stmt = conn.createStatement();
```

<hr>

### ⅴ. 명령 실행

- 명령 객체의 `executeQuery`혹은 `executeUpdate` 메서드를 통해 명령의 실행하게된다.
- 결과 집합이 생기는 명령일 경우 `ResultSet` 객체에 결과 저장

```java
ResultSet rs = stmt.executeQuery(sql);
```

- 이 때 rs에는 실행 결과가 위치한 주소값이 저장된다.
- 실행결과는 DB 서버 내부 버퍼에 저장된다.

<hr>

### ⅵ. 명령 결과 처리

- 명령의 결과는 다양한 방식을 처리 가능하다.

```java
while(rs.next()) {
  System.out.println(rs.getInt("empno") + "/" + 
            rs.getString("ename") + "/" + 
            rs.getInt("sal") + "/" + 
            rs.getInt("comm") + "/"
            );
}
```

<hr>

### ⅶ. 자원 해제

- JDBC 관련 자원은 네트워크 자원이라 GC가 자동으로 해제하지 않는다.    
- 즉, DB 사용이 종료되었으면 자원을 수동으로 해제해주어야한다.

```java
stmt.close();
rs.close();
conn.close();
```

<hr><br>

## Ⅲ. SQL 구문 입력

### Statement

일반적인 SQL 구문을 실행하기 위한 명령 객체

```java
Connection conn = null;
Statement stmt = null;

try {
  // 연결 객체 생성
  conn =  DriverManager.getConnection("jdbc:oracle:thin:@localhost:1521:xe", "KOSA", "1004");
  
  // 명령 객체 생성
  stmt = conn.createStatement();
  
  // sql 구문 생성
  int empno=0;
  String ename = null;
  int deptno=0;
  
  Scanner sc = new Scanner(System.in);
  
  System.out.println("사번 입력");
  empno = Integer.parseInt(ename);
  
  System.out.println("사번 입력");
  empno = Integer.parseInt(ename);
  
  System.out.println("사번 입력");
  empno = Integer.parseInt(ename);
  
  String sql="insert into dmlemp(empno, ename, deptno)";
  sql+= " values ( "+empno +",'" +ename +"'," + deptno+ ")";
  
  // 명령 실행
  int result = stmt.executeUpdate(sql);
  
  // 결과 처리
  System.out.println(result); // 1
} catch (Exception e) {
  System.out.println("DB 문제 발생");
  System.out.println(e.getMessage());
}
```

<hr>

### PreparedStatement

<hr>

### ※ Connection의 메서드들

- `isClosed()` : DB 연결 중이면 `false`, 아니면 `true` 반환
- `getMetaData().getDatabaseProductName()` : DB 제품명 반환
- `getMetaData().getDatabaseProductVersion()` : DB 제품의 버전 반환

```java
Connection conn = null;
try {
  // 편의를 위해 생성한 함수형 클래스입니다.
  conn = ConnectinoHelper.getConnection("oracle", "KOSA", "1004");  // 연결 생성

  System.out.println(conn.toString());
  // oracle.jdbc.driver.T4CConnection@5025a98f
  System.out.println(conn.getMetaData().getDatabaseProductName());
  // Oracle
  System.out.println(conn.getMetaData().getDatabaseProductVersion());
  // Oracle Database 11g Express Edition Release 11.2.0.2.0 - 64bit Production
  System.out.println(conn.isClosed());
  // false

  ConnectinoHelper.close(conn);  // 연결 종료

  System.out.println(conn.isClosed());
  // true
}
```

<hr><br>

## Ⅳ. 주의 사항

### ⅰ. executeUpdate의 결과

> `executeUpdate` : inser, update, delete에 사용되는 메서드

이 메서드 실행 시 결과 집합이이 아니라 반영된 행의 개수를 반환한다.

```java
String sql = "insert into dmlemp(empno, ename, deptno) values(9999, '문제아', 10)";

int result = stmt.executeUpdate(sql);

System.out.println(result); // 1
```

쿼리문이 DB에서 에러가 나면 JAVA에서는 예외로 처리된다.
- 반영된 행의 개수 0개가 반환되는 게 아니라는 것을 주의하자.

<hr>

### ⅱ. 자동 COMMIT

하지만 JDBC API를 통해 DML을 수행할 경우 자동 COMMIT된다.

옵션을 통해 COMMIT과 ROLLBACK 처리 방법을 제공